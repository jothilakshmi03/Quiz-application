<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .correct {
            background-color: #d4edda !important; /* green */
            border-radius: 5px;
            padding: 5px;
        }
        .wrong {
            background-color: #f8d7da !important; /* red */
            border-radius: 5px;
            padding: 5px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">

            <h2 class="text-center mb-4">ðŸŽ¯ Quiz App</h2>

            <!-- Quiz Questions -->
            <div id="quiz-container"></div>

            <!-- Submit Button -->
            <div class="text-center mt-4">
                <button class="btn btn-primary btn-lg" onclick="submitQuiz()">Submit Quiz</button>
            </div>

            <!-- Score Result -->
            <div id="score-container" class="alert alert-info mt-4 text-center d-none"></div>

        </div>
    </div>
</div>

<script>
    let questions = [];

    // Load questions from backend
    async function loadQuiz() {
      try {
        const response = await fetch("http://localhost:9090/api/questions?limit=5");
        questions = await response.json();

        const quizContainer = document.getElementById("quiz-container");
        quizContainer.innerHTML = "";

        questions.forEach((q, index) => {
          const qHtml = `
            <div class="card mb-3 shadow-sm" id="question-${q.id}">
              <div class="card-body">
                <h5 class="card-title">Q${index + 1}. ${q.questionText}</h5>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q${q.id}" value="A">
                  <label class="form-check-label">${q.optionA}</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q${q.id}" value="B">
                  <label class="form-check-label">${q.optionB}</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q${q.id}" value="C">
                  <label class="form-check-label">${q.optionC}</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q${q.id}" value="D">
                  <label class="form-check-label">${q.optionD}</label>
                </div>
              </div>
            </div>
          `;
          quizContainer.innerHTML += qHtml;
        });
      } catch (err) {
        console.error("Error loading quiz:", err);
      }
    }

    // Submit quiz
    async function submitQuiz() {
      const answers = {};
      questions.forEach(q => {
        const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
        answers[q.id] = selected ? selected.value : null;
      });

      try {
        const response = await fetch("http://localhost:9090/api/questions/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ answers })
        });

        const result = await response.json();
        console.log("Result from backend:", result);

        // Show score
        const scoreContainer = document.getElementById("score-container");
        scoreContainer.classList.remove("d-none");
        scoreContainer.innerHTML = `<h4>âœ… Your Score: ${result.score}/${result.total}</h4>`;

        // Highlight correct and wrong answers
        questions.forEach(q => {
          const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
          const selectedValue = selected ? selected.value : null;

          // Fetch correct answer from backend (you should add correctOption in result for this)
          fetch(`http://localhost:9090/api/questions/${q.id}`)
            .then(res => res.json())
            .then(fullQuestion => {
              const correctAnswer = fullQuestion.correctAnswer;

              // Mark wrong selection
              if (selected && selectedValue !== correctAnswer) {
                selected.parentElement.classList.add("wrong");
              }

              // Mark correct option
              const correctOption = document.querySelector(`input[name="q${q.id}"][value="${correctAnswer}"]`);
              if (correctOption) {
                correctOption.parentElement.classList.add("correct");
              }
            });
        });

      } catch (err) {
        console.error("Error submitting quiz:", err);
      }
    }

    // Load quiz when page starts
    loadQuiz();
</script>

</body>
</html>
